# Contributing to the SaaS Event Maturity Matrix (EMM)

## Use Cases
- Adding a new SaaS platform and/or Event Source
- Providing feedback on a current EMM mapping and/or documentation
- Providing feedback regarding the EMM Framework, such as Categories, Event Types, and/or Event Attributes

## Recommended Pre-Requisites
- Review basic EMM schema and definitions to understand Event Types and Attributes
- Have a general idea of what SaaS platform you wish to assess, as well as which Event Source(s) are in scope
- Have admin access to a SaaS platform, as well as access to raw events generated by the SaaS platform
- Have access to SaaS platform documentation regarding APIs, event schemas, and general information regarding audit logging

## Adding a New SaaS Platform to the EMM  
A convenience MAKEFILE has been created to generate all the necessary files for a new SaaS platform.  To use the MAKEFILE, run the following command:
```bash
make create_product
```
This will prompt you to enter the name of the SaaS platform you wish to assess, followed by prompts that will automatically create the directories, files, and documentation necessary for that product.

### The Product File
1. Reference existing product files for real-world examples via `/products/[saas_name]/`
1. In the `product` YAML file, document an overview of the SaaS platform, including:
	- A description of the platform
	- A name, description, and URL reference for API endpoints that are available for audit log collection

### The Event Source File: Documentation
1. The Event Source file is the core content of the EMM.  Event sources should be scoped to a single API endpoint. If there are multiple endpoints that generate different events, they should be scoped to separate event sources.
1. In the Event Source YAML file(s), document an overview of the SaaS platform Event Source being assessed, including:
	- Which collection API endpoint is associated with this Event Source (documented in the `product` YAML file)
	- A name and description of the Event Source
	- A reference name and URL regarding the Event Source event schema (if published online)
	- Context regarding Event Source retention, latency, and licensing
1.  For now ignore the `mappings` section of the Event Source YAML file.  We will come back to this after we have mapped the event data against the EMM Framework  

### EMM Mapping for the Event Source
We'll now temporarily pivot away from the Event Source YAML file and begin mapping SaaS event data against the EMM Framework.  After investigating multiple approaches, we found that the most effective way to map the data is to use a Google Sheet to generate the rest of the content of the event sources YAML file 

1. A template Google Sheet [Copy Assessment Heat Map](https://docs.google.com/spreadsheets/d/13rgvQRCNkmWtGLq2JgahYQmnenQRvAHCTR_BsDA4VXE/copy) has been created to simplify assessing a SaaS platform's Event Source.  Click the link to generate a copy of the sheet for your use.
1. The template has 3 tabs:
	1. `Mapping Input`: used to capture the Event Source mapping against the EMM, including the raw service field that aligns with the Event Attribute.  This is the only tab that should need to be completed. 
	1. `Mapping Output`: contains various spreadsheet formulas that help automate the EMM mapping. It's used to help generate the event sources YAML file; no action is required with this tab
	1. `EventAttribute Mapping`: a helper tab used to populate spreadsheet formulas; no action is required with this tab
1. One Event Type at a time, map the attributes of example collected log data against EMM framework 
	1. This requires searching for real world examples and/or generating the events yourself manually
	1. This may also require researching SaaS platform event schema documentation to verify the existence of certain Event Types
	1. If the Event Type exists, map the raw event field name against the associated EMM event attributes
	1. If the Event Type or an event attribute does not exist for an event type, leave blank
	1. Once the Event Type has been assessed, export a raw event sample in JSON format locally. To ensure peer review is feasible, each `event_type` should have at least one sample event.  This makes it possible for others to see example raw logs from the SaaS platform and the attributes that are available
       - The `create_product` MAKEFILE command will create a directory called `event_examples` in the product directory.  This is where the raw event samples should be stored
       - The MAKEFILE command also auto-generates empty JSON files for each event type. The JSON files following the naming convention of `<category>_<event_type>.json`
       - Some services may generate an event with outcomes such as `success` or `failure`.  In these cases, it is important to have examples of both outcomes where possible.  The naming convention for these files should be `<category>_<event_type>_<outcome>.json`
       - The event samples should be sanitized to remove any sensitive information.  While sanitizing data, it is important to maintain some contextual consistency with the data that is being sanitized.  For example an email field should have a fake, but semantically valid email address
1. With all the sample log links added to the event sources file, and the spreadsheet complete, the last step involves running the MAKEFILE command to finalize the event sources file.  This will take the data from the spreadsheet and add all the attributes for each event type.  The command to run is:
```bash
make update_event_sources
```
This will prompt you for:  
- the id of the Google spreadsheet you used to map the data (make sure it is publicly available to read, the value is located in the URL of the sheet after `https://docs.google.com/spreadsheets/d/` and before `/edit`)
- the id of the sheet tab named `Mapping Output` (in the URL of the sheet, this is the value after `gid=`)
- the filename of the event sources file you wish to update (the name of the event sources file in the product directory under `event_sources`, for example `github_audit_events.event_sources.yml`)  

> **Important Note:** It's difficult to peer-review all Event Type and Event Attribute mappings when assessing an Event Source. Therefore, it's essential to be thorough in testing and assessing a SaaS platform, and collaborative with peers in order to ensure the highest quality output. Please escalate any questions or comments as issues in the repository.


### Validation
When a pull request is opened in the EMM repository, GitHub Actions will automatically validate the YAML files against the schema files. If any of the files are invalid, the pipeline will fail and you will be required to fix the issue before the pull request can be merged.